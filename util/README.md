# QLogo Utility Scripts and Supporting Files

This directory contains various utility scripts used for generating and maintaining the supporting files for QLogo, as well as scripts for maintaining code quality.

It is not necessary to run these scripts as part of the normal build process. They should only be used when the relevant sources are modified.

The files generated by these scripts are included in the QLogo distribution.

## Code Generation Scripts

### generate_command_table.py

Generates the header and table files for QLogo primitives from source files. Run this script when any of the relevant executor method signatures are changed or when their command interfaces are changed.

To use, run:

```sh
cd Projects/QLogo
util/generate_command_table.py qlogo/executor include/primitives.h include/workspace/primitivetable.h
```

### generate_help.py

Generates the help text for QLogo commands from source files. Run this script when any of the relevant command help text is changed.

The script takes two arguments: the path to the directory containing the executor source files and the path to the JSON file containing the help text for library routines.

To use, run:

```sh
cd Projects/QLogo
util/generate_help.py qlogo/executor util/logolib_help.json share/qlogo_help.db
```

### generate_library.py

Generates the library files for QLogo from source files. Run this script when any of the relevant library source files are changed.

To use, run:

```sh
cd Projects/QLogo
util/generate_library.py util/logolib.json share/qlogo_library.db
```

### createDesktopIcons.sh

Reads the master desktop icon png file and generates a set of icon files for the QLogo desktop application.

To use, run:

```sh
createDesktopIcons.sh
```

Unlike the other scripts, this file can be run from anywhere. It is not necessary to cd to a specific directory before running it.

## Code Quality Scripts

### run-clang-tools.sh

A convenience script to run clang-format and/or clang-tidy on the codebase.

#### Usage

```bash
# Run both format and tidy
./util/run-clang-tools.sh

# Or specify which to run
./util/run-clang-tools.sh format  # Only format
./util/run-clang-tools.sh tidy    # Only tidy
./util/run-clang-tools.sh both    # Both (default)
```

#### What it does

- **format**: Automatically formats all C++ files using clang-format
- **tidy**: Runs clang-tidy analysis on all C++ files and outputs results to `clang_tidy.out`

The script automatically:
- Finds all C++ source files in `qlogo/`, `Psychi/`, and `include/`
- Generates `compile_commands.json` if needed (for clang-tidy)
- Excludes build directories and generated files

## Git Hooks

### Installation

After cloning the repository, install the git hooks:

```bash
./util/install-git-hooks.sh
```

This will install:
- **pre-commit**: Automatically formats staged C++ files
- **commit-msg**: Enforces conventional commit message format

### Pre-commit Hook

A pre-commit hook automatically formats staged C++ files before commit. This ensures consistent code style without manual intervention.

The hook:
- Only processes staged `.cpp`, `.h`, `.hpp`, `.c`, and `.cc` files
- Automatically formats files that need formatting
- Re-stages formatted files
- Does not block commits (only formats)

### Commit Message Hook

Enforces conventional commit format: `type(scope): subject`

Examples:
- `feat(parser): add support for nested lists`
- `fix(compiler): resolve memory leak`
- `docs: update README`

To bypass hooks (not recommended):
```bash
git commit --no-verify
```

## CI/CD

### GitHub Actions

The `.github/workflows/clang-tidy.yml` workflow runs clang-tidy on pull requests and pushes to main/master.

- Runs automatically on PRs and pushes
- Only triggers when C++ files or configuration changes
- Uploads results as artifacts
- Comments on PRs with summary of issues

## Manual Usage

You can also run the tools directly:

```bash
# Format a specific file
clang-format -i path/to/file.cpp

# Format all files (from project root)
find qlogo Psychi include -name "*.cpp" -o -name "*.h" | xargs clang-format -i

# Run clang-tidy on a specific file
clang-tidy -p . path/to/file.cpp

# Run clang-tidy on all files
find qlogo Psychi include -name "*.cpp" -o -name "*.h" | xargs clang-tidy -p .
```

## Supporting Files

### logolib_help.json

Contains the help text for QLogo library routines. The script, `generate_help.py`, reads this file and generates the help text SQLite database.

### logolib.json

Contains the library routines for QLogo. The script, `generate_library.py`, reads this file and generates the QLogo library SQLite database.
